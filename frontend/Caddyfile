{
    http_port 80
}

:80 {
    root * /srv
    file_server

    # CADDY_GUAC_CLIENT_URL will be provided by docker-compose environment
    handle_path /tunnel* {
        reverse_proxy {$CADDY_GUAC_CLIENT_URL} {
            transport http {
                tls
                tls_insecure_skip_verify
            }
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }

    handle_path /websocket-tunnel* {
        reverse_proxy {$CADDY_GUAC_CLIENT_URL} {
            transport http {
                tls
                tls_insecure_skip_verify
            }
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }

    log {
        output stdout
        format console
    }
} 